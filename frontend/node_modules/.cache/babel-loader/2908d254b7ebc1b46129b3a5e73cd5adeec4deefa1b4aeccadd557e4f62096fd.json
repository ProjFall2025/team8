{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\vp141\\\\smart-property-system\\\\frontend\\\\src\\\\pages\\\\RoleProtectedRoute.js\",\n  _s = $RefreshSig$();\nimport { Navigate } from 'react-router-dom';\nimport { useEffect, useState } from 'react';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function RoleProtectedRoute({\n  children,\n  allowedRoles\n}) {\n  _s();\n  var _user$role;\n  const [token, setToken] = useState(undefined); // undefined = not checked yet\n  const [user, setUser] = useState(undefined);\n  useEffect(() => {\n    const t = localStorage.getItem('token');\n    const u = localStorage.getItem('user');\n    setToken(t);\n    setUser(u ? JSON.parse(u) : null);\n    console.log(\"üë§ User read in RoleProtectedRoute:\", u);\n  }, []);\n  if (token === undefined || user === undefined) {\n    return null; // or a spinner/loading screen\n  }\n\n  // ‚ùå No token or user ‚Üí redirect\n  if (!token || !user) {\n    return /*#__PURE__*/_jsxDEV(Navigate, {\n      to: \"/login\",\n      replace: true\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 23,\n      columnNumber: 12\n    }, this);\n  }\n\n  // üîé Expiry check\n  try {\n    const payload = JSON.parse(atob(token.split('.')[1]));\n    if (payload.exp * 1000 < Date.now()) {\n      console.log(\"‚è∞ Token expired, redirecting to login\");\n      localStorage.removeItem('token');\n      localStorage.removeItem('user');\n      return /*#__PURE__*/_jsxDEV(Navigate, {\n        to: \"/login\",\n        replace: true\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 33,\n        columnNumber: 14\n      }, this);\n    }\n  } catch (err) {\n    console.error(\"‚ö†Ô∏è Invalid token format\", err);\n    return /*#__PURE__*/_jsxDEV(Navigate, {\n      to: \"/login\",\n      replace: true\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 37,\n      columnNumber: 12\n    }, this);\n  }\n\n  // ‚úÖ Role check\n  const normalizedRole = (_user$role = user.role) === null || _user$role === void 0 ? void 0 : _user$role.toLowerCase();\n  const normalizedAllowed = allowedRoles.map(r => r.toLowerCase());\n  if (!normalizedAllowed.includes(normalizedRole)) {\n    return /*#__PURE__*/_jsxDEV(Navigate, {\n      to: \"/unauthorized\",\n      replace: true\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 46,\n      columnNumber: 12\n    }, this);\n  }\n  return children;\n}\n_s(RoleProtectedRoute, \"635j3JMvn+L0kVm1HUfMS1Cf53w=\");\n_c = RoleProtectedRoute;\nvar _c;\n$RefreshReg$(_c, \"RoleProtectedRoute\");","map":{"version":3,"names":["Navigate","useEffect","useState","jsxDEV","_jsxDEV","RoleProtectedRoute","children","allowedRoles","_s","_user$role","token","setToken","undefined","user","setUser","t","localStorage","getItem","u","JSON","parse","console","log","to","replace","fileName","_jsxFileName","lineNumber","columnNumber","payload","atob","split","exp","Date","now","removeItem","err","error","normalizedRole","role","toLowerCase","normalizedAllowed","map","r","includes","_c","$RefreshReg$"],"sources":["C:/Users/vp141/smart-property-system/frontend/src/pages/RoleProtectedRoute.js"],"sourcesContent":["import { Navigate } from 'react-router-dom';\r\nimport { useEffect, useState } from 'react';\r\n\r\nexport default function RoleProtectedRoute({ children, allowedRoles }) {\r\n  const [token, setToken] = useState(undefined); // undefined = not checked yet\r\n  const [user, setUser] = useState(undefined);\r\n\r\n  useEffect(() => {\r\n    const t = localStorage.getItem('token');\r\n    const u = localStorage.getItem('user');\r\n    setToken(t);\r\n    setUser(u ? JSON.parse(u) : null);\r\n\r\n    console.log(\"üë§ User read in RoleProtectedRoute:\", u);\r\n  }, []);\r\n\r\n  if (token === undefined || user === undefined) {\r\n    return null; // or a spinner/loading screen\r\n  }\r\n\r\n  // ‚ùå No token or user ‚Üí redirect\r\n  if (!token || !user) {\r\n    return <Navigate to=\"/login\" replace />;\r\n  }\r\n\r\n  // üîé Expiry check\r\n  try {\r\n    const payload = JSON.parse(atob(token.split('.')[1]));\r\n    if (payload.exp * 1000 < Date.now()) {\r\n      console.log(\"‚è∞ Token expired, redirecting to login\");\r\n      localStorage.removeItem('token');\r\n      localStorage.removeItem('user');\r\n      return <Navigate to=\"/login\" replace />;\r\n    }\r\n  } catch (err) {\r\n    console.error(\"‚ö†Ô∏è Invalid token format\", err);\r\n    return <Navigate to=\"/login\" replace />;\r\n  }\r\n\r\n  // ‚úÖ Role check\r\n  const normalizedRole = user.role?.toLowerCase();\r\n  const normalizedAllowed = allowedRoles.map(r => r.toLowerCase());\r\n\r\n\r\n  if (!normalizedAllowed.includes(normalizedRole)) {\r\n    return <Navigate to=\"/unauthorized\" replace />;\r\n  }\r\n\r\n  return children;\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}