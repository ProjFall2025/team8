{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\vp141\\\\smart-property-system\\\\frontend\\\\src\\\\pages\\\\RoleProtectedRoute.js\";\nimport { Navigate } from 'react-router-dom';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function RoleProtectedRoute({\n  children,\n  allowedRoles\n}) {\n  var _user, _user$role;\n  const userStr = localStorage.getItem('user');\n  const token = localStorage.getItem('token');\n\n  // ‚úÖ Fix: if token is missing or expired, redirect\n  if (!userStr || !token) {\n    return /*#__PURE__*/_jsxDEV(Navigate, {\n      to: \"/login\",\n      replace: true\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 9,\n      columnNumber: 12\n    }, this);\n  }\n  let user;\n  try {\n    user = JSON.parse(userStr);\n  } catch {\n    return /*#__PURE__*/_jsxDEV(Navigate, {\n      to: \"/login\",\n      replace: true\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 16,\n      columnNumber: 12\n    }, this);\n  }\n\n  // ‚úÖ Fix: check token expiry\n  try {\n    const payload = JSON.parse(atob(token.split('.')[1]));\n    if (Date.now() >= payload.exp * 1000) {\n      localStorage.removeItem('token');\n      localStorage.removeItem('user');\n      return /*#__PURE__*/_jsxDEV(Navigate, {\n        to: \"/login\",\n        replace: true\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 25,\n        columnNumber: 14\n      }, this);\n    }\n  } catch {\n    return /*#__PURE__*/_jsxDEV(Navigate, {\n      to: \"/login\",\n      replace: true\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 28,\n      columnNumber: 12\n    }, this);\n  }\n  const normalizedRole = (_user = user) === null || _user === void 0 ? void 0 : (_user$role = _user.role) === null || _user$role === void 0 ? void 0 : _user$role.toLowerCase();\n  const normalizedAllowed = allowedRoles.map(r => r.toLowerCase());\n  console.log('üîç RoleProtectedRoute check:', normalizedRole, 'vs allowed:', normalizedAllowed);\n  if (!normalizedRole || !normalizedAllowed.includes(normalizedRole)) {\n    return /*#__PURE__*/_jsxDEV(Navigate, {\n      to: \"/unauthorized\",\n      replace: true\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 37,\n      columnNumber: 12\n    }, this);\n  }\n  return children;\n}\n_c = RoleProtectedRoute;\nvar _c;\n$RefreshReg$(_c, \"RoleProtectedRoute\");","map":{"version":3,"names":["Navigate","jsxDEV","_jsxDEV","RoleProtectedRoute","children","allowedRoles","_user","_user$role","userStr","localStorage","getItem","token","to","replace","fileName","_jsxFileName","lineNumber","columnNumber","user","JSON","parse","payload","atob","split","Date","now","exp","removeItem","normalizedRole","role","toLowerCase","normalizedAllowed","map","r","console","log","includes","_c","$RefreshReg$"],"sources":["C:/Users/vp141/smart-property-system/frontend/src/pages/RoleProtectedRoute.js"],"sourcesContent":["import { Navigate } from 'react-router-dom';\r\n\r\nexport default function RoleProtectedRoute({ children, allowedRoles }) {\r\n  const userStr = localStorage.getItem('user');\r\n  const token = localStorage.getItem('token');\r\n\r\n  // ‚úÖ Fix: if token is missing or expired, redirect\r\n  if (!userStr || !token) {\r\n    return <Navigate to=\"/login\" replace />;\r\n  }\r\n\r\n  let user;\r\n  try {\r\n    user = JSON.parse(userStr);\r\n  } catch {\r\n    return <Navigate to=\"/login\" replace />;\r\n  }\r\n\r\n  // ‚úÖ Fix: check token expiry\r\n  try {\r\n    const payload = JSON.parse(atob(token.split('.')[1]));\r\n    if (Date.now() >= payload.exp * 1000) {\r\n      localStorage.removeItem('token');\r\n      localStorage.removeItem('user');\r\n      return <Navigate to=\"/login\" replace />;\r\n    }\r\n  } catch {\r\n    return <Navigate to=\"/login\" replace />;\r\n  }\r\n\r\n  const normalizedRole = user?.role?.toLowerCase();\r\n  const normalizedAllowed = allowedRoles.map(r => r.toLowerCase());\r\n\r\n  console.log('üîç RoleProtectedRoute check:', normalizedRole, 'vs allowed:', normalizedAllowed);\r\n\r\n  if (!normalizedRole || !normalizedAllowed.includes(normalizedRole)) {\r\n    return <Navigate to=\"/unauthorized\" replace />;\r\n  }\r\n\r\n  return children;\r\n}"],"mappings":";AAAA,SAASA,QAAQ,QAAQ,kBAAkB;AAAC,SAAAC,MAAA,IAAAC,OAAA;AAE5C,eAAe,SAASC,kBAAkBA,CAAC;EAAEC,QAAQ;EAAEC;AAAa,CAAC,EAAE;EAAA,IAAAC,KAAA,EAAAC,UAAA;EACrE,MAAMC,OAAO,GAAGC,YAAY,CAACC,OAAO,CAAC,MAAM,CAAC;EAC5C,MAAMC,KAAK,GAAGF,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC;;EAE3C;EACA,IAAI,CAACF,OAAO,IAAI,CAACG,KAAK,EAAE;IACtB,oBAAOT,OAAA,CAACF,QAAQ;MAACY,EAAE,EAAC,QAAQ;MAACC,OAAO;IAAA;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAE,CAAC;EACzC;EAEA,IAAIC,IAAI;EACR,IAAI;IACFA,IAAI,GAAGC,IAAI,CAACC,KAAK,CAACZ,OAAO,CAAC;EAC5B,CAAC,CAAC,MAAM;IACN,oBAAON,OAAA,CAACF,QAAQ;MAACY,EAAE,EAAC,QAAQ;MAACC,OAAO;IAAA;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAE,CAAC;EACzC;;EAEA;EACA,IAAI;IACF,MAAMI,OAAO,GAAGF,IAAI,CAACC,KAAK,CAACE,IAAI,CAACX,KAAK,CAACY,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;IACrD,IAAIC,IAAI,CAACC,GAAG,CAAC,CAAC,IAAIJ,OAAO,CAACK,GAAG,GAAG,IAAI,EAAE;MACpCjB,YAAY,CAACkB,UAAU,CAAC,OAAO,CAAC;MAChClB,YAAY,CAACkB,UAAU,CAAC,MAAM,CAAC;MAC/B,oBAAOzB,OAAA,CAACF,QAAQ;QAACY,EAAE,EAAC,QAAQ;QAACC,OAAO;MAAA;QAAAC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAE,CAAC;IACzC;EACF,CAAC,CAAC,MAAM;IACN,oBAAOf,OAAA,CAACF,QAAQ;MAACY,EAAE,EAAC,QAAQ;MAACC,OAAO;IAAA;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAE,CAAC;EACzC;EAEA,MAAMW,cAAc,IAAAtB,KAAA,GAAGY,IAAI,cAAAZ,KAAA,wBAAAC,UAAA,GAAJD,KAAA,CAAMuB,IAAI,cAAAtB,UAAA,uBAAVA,UAAA,CAAYuB,WAAW,CAAC,CAAC;EAChD,MAAMC,iBAAiB,GAAG1B,YAAY,CAAC2B,GAAG,CAACC,CAAC,IAAIA,CAAC,CAACH,WAAW,CAAC,CAAC,CAAC;EAEhEI,OAAO,CAACC,GAAG,CAAC,8BAA8B,EAAEP,cAAc,EAAE,aAAa,EAAEG,iBAAiB,CAAC;EAE7F,IAAI,CAACH,cAAc,IAAI,CAACG,iBAAiB,CAACK,QAAQ,CAACR,cAAc,CAAC,EAAE;IAClE,oBAAO1B,OAAA,CAACF,QAAQ;MAACY,EAAE,EAAC,eAAe;MAACC,OAAO;IAAA;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAE,CAAC;EAChD;EAEA,OAAOb,QAAQ;AACjB;AAACiC,EAAA,GAtCuBlC,kBAAkB;AAAA,IAAAkC,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}